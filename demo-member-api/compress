#!/bin/bash

OUTPUT_ZIP="demo-member-api.zip"
USER_HOST="user@ssrfrontendgms.duckdns.org"

if [ -f "$OUTPUT_ZIP" ]; then
    echo "Removing existing $OUTPUT_ZIP..."
    rm "$OUTPUT_ZIP"
fi

echo "Creating $OUTPUT_ZIP with compression level 9..."

zip -r -9 "$OUTPUT_ZIP" . \
    -x "node_modules/*" \
    -x "node_modules" \
    -x "package-lock.json"

if [ $? -eq 0 ]; then
    echo "Successfully created $OUTPUT_ZIP"
else
    echo "Error creating $OUTPUT_ZIP"
fi

# echo "Verifying zip file contents (first 20 lines):"
# unzip -l "$OUTPUT_ZIP" | head -n 20

scp "$OUTPUT_ZIP" "$USER_HOST:."
rm "$OUTPUT_ZIP"
scp extract "$USER_HOST:."
